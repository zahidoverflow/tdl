# This file is intentionally PowerShell (despite the .html extension).
# It enables: irm https://zahidoverflow.github.io/tdl | iex

$ErrorActionPreference = 'Stop'

$installUrl = $env:TDL_INSTALL_URL
if ([string]::IsNullOrWhiteSpace($installUrl)) {
    $installUrl = 'https://raw.githubusercontent.com/zahidoverflow/tdl/master/install.ps1'
}

try {
    $script = Invoke-RestMethod -Uri $installUrl -Headers @{ 'Cache-Control' = 'no-cache' } -ErrorAction Stop
} catch {
    Write-Error "Failed to download installer from $installUrl. Error: $_"
    exit 1
}

# Strip UTF-8 BOM if present (Windows PowerShell can fail to parse param defaults with BOM).
if ($script -is [string] -and $script.Length -gt 0 -and [int]$script[0] -eq 65279) {
    $script = $script.Substring(1)
}

if ([string]::IsNullOrWhiteSpace($script)) {
    Write-Error "Installer script is empty. URL: $installUrl"
    exit 1
}

$block = [ScriptBlock]::Create($script)
& $block @args
